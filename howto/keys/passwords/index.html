<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.26" />
    <meta name="description" content="The process of deriving  a cryptographic key from a password is called _password based key derivation_. Because passwords are often to short/predictable this derivation often also implements some kind of _key strengthening_ or _key stretching_.">


    <title>From password to key :: Bouncy GPG</title>
    <link rel="shortcut icon" href="https://neuhalje.github.io/bouncy-gpg/images/favicon.png" type="image/x-icon" />
    <link href="https://neuhalje.github.io/bouncy-gpg/css/nucleus.css" rel="stylesheet">
    <link href="https://neuhalje.github.io/bouncy-gpg/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://neuhalje.github.io/bouncy-gpg/css/hybrid.css" rel="stylesheet">
    <link href="https://neuhalje.github.io/bouncy-gpg/css/featherlight.min.css" rel="stylesheet">
    <link href="https://neuhalje.github.io/bouncy-gpg/css/horsey.css" rel="stylesheet">
    
    <link href="https://neuhalje.github.io/bouncy-gpg/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://neuhalje.github.io/bouncy-gpg/css/bootstrap.min.css">
    <script src="https://neuhalje.github.io/bouncy-gpg/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    

  </head>
  <body class="" data-url="/howto/keys/passwords/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
       
	<p>Bouncy GPG Documentation</p>
 


    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="https://neuhalje.github.io/bouncy-gpg/js/lunr.min.js"></script>
<script type="text/javascript" src="https://neuhalje.github.io/bouncy-gpg/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/neuhalje.github.io\/bouncy-gpg\/";
</script>
<script type="text/javascript" src="https://neuhalje.github.io/bouncy-gpg/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
            <li data-nav-id="/" class="dd-item">
            <a href="https://neuhalje.github.io/bouncy-gpg/"><i class="fa fa-fw fa-home"></i></a>
            </li>
        
        
        
          
          


 
  
    
    <li data-nav-id="/howto/" class="dd-item 
        parent
        
        
        ">
      <a href="https://neuhalje.github.io/bouncy-gpg/howto/">
        <span>HowTo</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/howto/keys/" class="dd-item 
        parent
        
        
        ">
      <a href="https://neuhalje.github.io/bouncy-gpg/howto/keys/">
        <span>Key generation and derivation</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/howto/keys/kdf/" class="dd-item 
        
        
        
        ">
      <a href="https://neuhalje.github.io/bouncy-gpg/howto/keys/kdf/">
        <span>Derive more keys from a key</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/howto/keys/kdf/example/derivingfromcryptographickeys/" class="dd-item
     
      ">
        <a href="https://neuhalje.github.io/bouncy-gpg/howto/keys/kdf/example/derivingfromcryptographickeys/">
        <span>Example: Deriving record specific keys</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/howto/keys/passwords/" class="dd-item 
        parent
        active
        
        ">
      <a href="https://neuhalje.github.io/bouncy-gpg/howto/keys/passwords/">
        <span>From password to key</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/howto/keys/passwords/example/convertingpasswordsintocryptographickeys/" class="dd-item
     
      ">
        <a href="https://neuhalje.github.io/bouncy-gpg/howto/keys/passwords/example/convertingpasswordsintocryptographickeys/">
        <span>Example: Converting a password into a cryptographic key</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
        

        
        <section id="shortcuts">
            
                <li class="" role="">
                    <h3>More</h3>
                    <a href="https://github.com/neuhalje/bouncy-gpg"><i class='fa fa-github'></i> Github repo</a>
                    
                </li>
            
                <li class="" role="">
                    
                    <a href="https://neuhalje.github.io/bouncy-gpg/about"><i class='fa fa-bullhorn'></i> About</a>
                    
                </li>
            
        </section>    
        
        

        
    </ul>
    
     
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                










 <a href='https://neuhalje.github.io/bouncy-gpg/'></a> > <a href='https://neuhalje.github.io/bouncy-gpg/howto/'>HowTo</a> > <a href='https://neuhalje.github.io/bouncy-gpg/howto/keys/'>Key generation and derivation</a> > From password to key

 

 

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#requirements-for-key-derivation">Requirements for key derivation</a>
<ul>
<li><a href="#deterministic">Deterministic</a></li>
<li><a href="#password-length">Password length</a></li>
</ul></li>
<li><a href="#prevent-pre-computation-with-salt">Prevent pre-computation with salt</a></li>
<li><a href="#unwanted-structure-lacking-entropy">Unwanted structure / lacking entropy</a></li>
<li><a href="#examples">Examples</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
          <div id="tags">
            
              <a class="label label-default" href="https://neuhalje.github.io/bouncy-gpg//tags/howto">howto</a>
            
              <a class="label label-default" href="https://neuhalje.github.io/bouncy-gpg//tags/key-derivation">key derivation</a>
            
              <a class="label label-default" href="https://neuhalje.github.io/bouncy-gpg//tags/passwords">passwords</a>
            
              <a class="label label-default" href="https://neuhalje.github.io/bouncy-gpg//tags/todo">TODO</a>
            
          </div>
        
        <div id="body-inner">
          
            <h1>From password to key</h1>
          






<p>The words <em>password</em> and <em>cryptographic key</em> are often used interchangeably, although they are technically very different.
Most systems use passwords to <em>derive</em> cryptographic keys, e.g. the password entered to decrypt a ZIP file is used to derive  a cryptographic key, which then is used to en-/decrypt the ZIP file.</p>

<p>The process of deriving  a cryptographic key from a password is called <em>password based key derivation</em>. Because passwords are often to short/predictable this derivation often also implements some kind of <em>key strengthening</em> or <em>key stretching</em> (see below for more info).</p>

<div class="mermaid" align="left" >
graph LR;
    P(Password) --> PBKDF[fa:fa-cog Password based Key Derivation Function]
    S(Salt) --> PBKDF
    PBKDF --> K(fa:fa-key Key)
    K -.-> AES[fa:fa-cog AES]
</div>

<p>To properly derive a key from a passwords a few aspects are important to consider.</p>

<div class="panel panel-success">
	<div class="panel-heading">TL;RD: Recommendation</div>
	<div class="panel-body"><p><em>Recommendation</em>:</p>

<ul>
<li>Always use a key derivation function. <em>Never</em> use input key material without a key derivation function.</li>
<li>Use long and complex passwords as key source (128 bit key =&gt; 22 characters, 256 bit keys =&gt; 44 characters!)</li>
<li>Use a random salt value that is as long as the key (128 or 256 bits)</li>
<li>Configure the key stretching to be as slow (sic!) as possible</li>
</ul>
</div>
	
</div>


<p>Cryptographic key derivation functions should be used to derive a key from a password (or <em>any</em> other source material).
Bouncy-GPG uses <a href="https://en.wikipedia.org/wiki/Scrypt">SCrypt</a>  for key stretching.</p>

<h2 id="requirements-for-key-derivation">Requirements for key derivation</h2>

<p>For those interested in learning a bit of background about key derivation the following paragraphs give a very short overview of the basic requirements of key derivation (from a password).</p>

<p>These are not all requirements for key derivation functions. The requirements shown here shed some light on key derivation  functions from an <em>API user</em> perspective.</p>

<h3 id="deterministic">Deterministic</h3>

<p>The process of key derivation has to be <a href="https://en.wikipedia.org/wiki/Deterministic_system">deterministic</a>. That is, given the same input parameters (password and other parameters of the <em>derivation function</em>) the generated key is always the same.</p>

<h3 id="password-length">Password length</h3>

<p>Cryptographically strong passwords are remarkably difficult to use because they are really, really long.
For the sake of discussion assume a password with the allowed symbols <code>a-z + A-Z + 0-9</code>. That are 62 different symbols per character. This is a bit less than ~6 bit per character.</p>

<p>A cryptographic key typically has a length of 128 or 256 completely random bits. E.g. a secure 128 bit key would require a completely random password of 22 characters (precisely <code>128 / log_2(62)</code> [*]). Sometimes this cannot be ensured, for example when the password is a users login password.</p>

<p>To derive keys from passwords two length-related problems need to be solved:</p>

<ol>
<li>Squash arbitrary long passwords into 128 / 256 bit keys</li>
<li>Prevent attackers from enumerating (to short) passwords</li>
</ol>

<p>[*] <em>Rule of thumb: <code>c</code> possible symbols are <code>log_2(c)</code> bits per character. <code>n</code> characters are then <code>n * log_2(c)</code> bits.  If your calculator does not have <code>log_2</code> use <code>num_bits ~= n * 3.3 * log_10(c)</code></em></p>

<h2 id="prevent-pre-computation-with-salt">Prevent pre-computation with salt</h2>

<p>Especially for short passwords it is desirable to prevent attackers from pre-computing (e.g. with <a href="https://en.wikipedia.org/wiki/Rainbow_table">Rainbow tables</a>)
all possible keys upfront.</p>

<p>There are two strategies to achieve this.</p>

<p>First the calculation can include an additional parameter that makes key derivation specific to an application/installation.
This raises the bar for the attacker because the pre-computation for one application cannot be used for a second application.
Such a value is called a <a href="https://en.wikipedia.org/wiki/Salt_%28cryptography%29">salt</a> and can be public.</p>

<p>Adding a salt value often is not enough. Even with <a href="http://cynosureprime.blogspot.de/2017/08/320-million-hashes-exposed.html">consumer hardware</a> simple hashes like SHA-1 or SHA-256 can be calculated at rates of <em>mega hashes per second</em>.</p>

<p>Secondly, computation can be made very expensive, so that an attacker would need to spend to much time to compute all possible keys.
This approach is implemented by functions such as  <a href="https://en.wikipedia.org/wiki/Scrypt">SCrypt</a> or <a href="https://tools.ietf.org/html/rfc2898">PBKDF2</a>.
Slowing down computations is especially important for cases where the attacker has access to the database with the password hashes (and the salt). This is not unlikely because databases are stolen quite frequently.
Brute force protection makes key generation much slower, thus hampering an attacker to just try out every possible user password to &ldquo;brute force&rdquo; the key.</p>

<p>Changing the salt value will derive different keys from the same password (thus making  precomputing infeasible).</p>

<h2 id="unwanted-structure-lacking-entropy">Unwanted structure / lacking entropy</h2>

<p>Besides the length of the password, it also has a lot of inherent structure (e.g. the mentioned 62 symbols all have the most significant bit set to zero). This structure needs to be &ldquo;smoothed out&rdquo; before using the password das key material.</p>

<h2 id="examples">Examples</h2>













<ul class="children children-li">
	
    
    

	
		
	
		
  


<li>
<a href="https://neuhalje.github.io/bouncy-gpg/howto/keys/passwords/example/convertingpasswordsintocryptographickeys/" >Example: Converting a password into a cryptographic key</a>
</li>






			
				
<p>This example will derive a 256 bit AES key from passwords.</p>
				
			
		

		
			

		
	

	
</ul>

<h2 id="further-reading">Further Reading</h2>

<ul>
<li><a href="https://en.wikipedia.org/wiki/Key_stretching">Key stretching</a> on Wikipedia.</li>
<li><a href="http://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf">NIST Special Publication 800-132: Recommendation for Password-Based Key Derivation</a></li>
<li><a href="https://en.wikipedia.org/wiki/Key_derivation_function">Key derivation function</a> on Wikipedia.</li>
</ul>





<footer class=" footline" >
	
</footer>





      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="https://neuhalje.github.io/bouncy-gpg/howto/keys/kdf/example/derivingfromcryptographickeys/" title="Example: Deriving record specific keys"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="https://neuhalje.github.io/bouncy-gpg/howto/keys/passwords/example/convertingpasswordsintocryptographickeys/" title="Example: Converting a password into a cryptographic key" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/clipboard.min.js"></script>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/featherlight.min.js"></script>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/html5shiv-printshiv.min.js"></script>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/modernizr.custom.71422.js"></script>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/learn.js"></script>
    <script src="https://neuhalje.github.io/bouncy-gpg/js/hugo-learn.js"></script>

    
    <link href="https://neuhalje.github.io/bouncy-gpg/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="https://neuhalje.github.io/bouncy-gpg/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    

  </body>
</html>
